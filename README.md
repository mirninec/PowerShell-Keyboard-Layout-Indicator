# PowerShell-Keyboard-Layout-Indicator
–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤ PowerShell

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (`<en>` –∏–ª–∏ `<ru>`) —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π –ø—Ä—è–º–æ –≤ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ PowerShell.

## ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- –¶–≤–µ—Ç–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è:
  - üü¢ –ó–µ–ª–µ–Ω—ã–π ‚Äî –∞–Ω–≥–ª–∏–π—Å–∫–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ (`<en>`)
  - üîµ –°–∏–Ω–∏–π ‚Äî —Ä—É—Å—Å–∫–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ (`<ru>`)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–∞—Å–∫–ª–∞–¥–∫–∏
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ **PowerShell 7 –∏ –≤—ã—à–µ**

---

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ PowerShell 7
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:

```powershell
# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
mkdir "$env:USERPROFILE\Documents\system" -Force

# –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª —Å–∫—Ä–∏–ø—Ç–∞ –≤ VS Code
code "$env:USERPROFILE\Documents\system\keyboard_prompt.ps1"
```

3. –í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ –≤ –æ—Ç–∫—Ä—ã–≤—à–∏–π—Å—è —Ñ–∞–π–ª:

```powershell
<#
.SYNOPSIS
    –î–æ–±–∞–≤–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ PowerShell
#>

Add-Type @"
using System;
using System.Runtime.InteropServices;
public class KeyboardLayout {
    [DllImport("user32.dll")]
    private static extern IntPtr GetKeyboardLayout(uint idThread);

    [DllImport("user32.dll")]
    private static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId);

    [DllImport("user32.dll")]
    private static extern IntPtr GetForegroundWindow();

    public static string GetCurrentKeyboardLayout() {
        try {
            IntPtr foregroundWindow = GetForegroundWindow();
            uint processId;
            uint threadId = GetWindowThreadProcessId(foregroundWindow, out processId);
            IntPtr keyboardLayout = GetKeyboardLayout(threadId);
            uint localeId = (uint)keyboardLayout.ToInt32() & 0xFFFF;
            return new System.Globalization.CultureInfo((int)localeId).Name;
        } catch {
            return "en-US"; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∞–Ω–≥–ª–∏–π—Å–∫—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        }
    }
}
"@

function global:prompt {
    $layout = [KeyboardLayout]::GetCurrentKeyboardLayout()
    $indicator = if ($layout -like "en-*") {
        "`e[38;5;34m<en>`e[0m"  # –∑–µ–ª—ë–Ω—ã–π
    } else {
        "`e[38;5;27m<ru>`e[0m"   # —Å–∏–Ω–∏–π (–∫–æ–¥ 27)
    }
    "PS $($executionContext.SessionState.Path.CurrentLocation)$indicator "
}
```

---

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è PowerShell

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –ø—Ä–æ—Ñ–∏–ª—è PowerShell:

```powershell
code $PROFILE
```

2. –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ —Å—Ç—Ä–æ–∫—É:

```powershell
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
. "$env:USERPROFILE\Documents\system\keyboard_prompt.ps1"
```

3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª (Ctrl+S)

---

### 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:

```powershell
. $PROFILE
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –≤ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ PowerShell –ø–æ—è–≤–∏—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä:

```powershell
PS C:\Users\UserName<en>
```

–ì–¥–µ:
- `<en>` ‚Äî –∑–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–∏
- `<ru>` ‚Äî —Å–∏–Ω–∏–π —Ü–≤–µ—Ç –¥–ª—è —Ä—É—Å—Å–∫–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–∏

---

## ‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
   - Windows 10/11
   - PowerShell 7.0 –∏–ª–∏ –Ω–æ–≤–µ–µ
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Windows Terminal –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤

2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**:
   - –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ PowerShell ISE
   - –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ Windows PowerShell 5.1

3. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**:
   - –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞—Å–∫–ª–∞–¥–∫—É –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–∫–Ω–∞
   - –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

---

## üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, –∑–∞–º–µ–Ω–∏–≤ –∫–æ–¥—ã –≤ —Å–∫—Ä–∏–ø—Ç–µ:

- `38;5;34m` ‚Äî –∑–µ–ª–µ–Ω—ã–π (–∫–æ–¥ 34)
- `38;5;27m` ‚Äî —Å–∏–Ω–∏–π (–∫–æ–¥ 27)

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```powershell
for ($i = 0; $i -lt 256; $i++) {
  Write-Host "`e[38;5;${i}m$i`e[0m " -NoNewline
  if (($i + 1) % 16 -eq 0) { Write-Host }
}
```

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```powershell
. $PROFILE
```

–¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.
